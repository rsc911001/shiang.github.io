<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>49è™Ÿå¤§æ¨‚é€æ©Ÿ & è³“æœå½©åˆ¸</title>
    <!-- ä½¿ç”¨ Tailwind CSS å¿«é€Ÿæ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FFF8E1;
        }

        /* === å…±ç”¨æ¨£å¼ === */
        .tab-btn {
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            background: #e0e0e0;
            color: #666;
        }
        .tab-btn.active {
            background: #fff;
            color: #c0392b;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
        }

        /* === é–‹çæ©Ÿæ¨£å¼ === */
        .machine-container {
            width: 460px; 
            height: 460px; 
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b);
            border-radius: 50%;
            border: 12px solid #f1c40f; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.3), inset 0 -15px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .machine-shine {
            position: absolute;
            top: 10%;
            left: 10%;
            width: 30%;
            height: 20%;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: rotate(-45deg);
            z-index: 10;
        }
        .result-ball {
            width: 340px; 
            height: 340px; 
            background: radial-gradient(circle at 30% 30%, #ffffff, #ecf0f1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 220px; 
            font-weight: 900;
            color: #c0392b;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border: 16px solid #e74c3c; 
            z-index: 20;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .result-ball.show { opacity: 1; transform: scale(1); }
        
        .rolling-text { 
            font-size: 220px; 
            color: rgba(255,255,255,0.8); 
            font-weight: bold; 
            display: none; 
        }
        .rolling .rolling-text { display: block; animation: shake 0.1s infinite; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .grid-ball {
            width: 100%; aspect-ratio: 1; border-radius: 50%; background-color: #e0e0e0; color: #999;
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1rem; 
            border: 2px solid #ccc;
        }
        .grid-ball.active { background: radial-gradient(circle at 30% 30%, #f1c40f, #f39c12); color: #fff; border-color: #d35400; transform: scale(1.1); }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .big-btn { background: linear-gradient(to bottom, #27ae60, #2ecc71); border-bottom: 6px solid #219150; transition: all 0.1s; }
        .big-btn:active { transform: translateY(4px); border-bottom: 2px solid #219150; }
        .big-btn:disabled { background: #95a5a6; border-bottom: 6px solid #7f8c8d; cursor: not-allowed; }
        
        .reset-btn { background: #e74c3c; color: white; border-radius: 8px; padding: 8px 16px; font-size: 1rem; }
        .bg-particle { position: absolute; border-radius: 50%; opacity: 0.6; pointer-events: none; }
        
        /* === ã€ä¿®æ”¹ã€‘å·¦å´å¤§æ¸…å–®æ¨£å¼ï¼šèª¿æ•´å°ºå¯¸ä»¥é©æ‡‰ä¸€æ’ 5 å€‹ === */
        .list-ball-item {
            width: 60px;  /* ã€ä¿®æ”¹ã€‘ç¸®å°å°ºå¯¸ (åŸ75px) */
            height: 60px; /* ã€ä¿®æ”¹ã€‘ç¸®å°å°ºå¯¸ (åŸ75px) */
            background: radial-gradient(circle at 30% 30%, #ffffff, #f0f0f0);
            border: 3px solid #c0392b; /* ã€ä¿®æ”¹ã€‘é‚Šæ¡†å¾®èª¿ */
            border-radius: 50%;
            color: #c0392b;
            font-weight: 900; 
            font-size: 1.8rem; /* ã€ä¿®æ”¹ã€‘ç¸®å°å­—é«” (åŸ2.2rem) */
            display: flex; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            animation: slideIn 0.3s ease-out;
            margin: 0 auto; 
        }
        @keyframes slideIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* === è³“æœç›¤æ¨£å¼ === */
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7æ¬„ */
            gap: 0; /* æ ¼å­ç·Šè²¼ */
            border: 4px solid #c0392b;
            background-color: #c0392b; /* é‚Šæ¡†è‰² */
            width: 100%;
            aspect-ratio: 1; /* ä¿æŒæ­£æ–¹å½¢ */
        }
        .bingo-cell {
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            border: 1px solid #ddd;
            aspect-ratio: 1;
        }

        /* å½©åˆ¸åˆ—å°å®¹å™¨æ¨£å¼ */
        .ticket-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            width: 100%;
            max-width: 600px; /* é™åˆ¶å¯¬åº¦ï¼Œåˆ—å°æ™‚æ›´å¥½çœ‹ */
            margin: 0 auto;
        }
        .lottery-ticket {
            background: white;
            border: 4px dashed #c0392b; /* è™›ç·šé‚Šæ¡†æ¯”è¼ƒå¥½å‰ªè£ */
            border-radius: 8px;
            padding: 15px;
            position: relative;
            page-break-inside: avoid;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .ticket-header {
            text-align: center;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }

        /* åˆ—å°å°ˆç”¨ CSS */
        @media print {
            body { background: white; padding: 0; }
            nav, header, #setup-area, .no-print { display: none !important; }
            #section-print { display: block !important; width: 100%; }
            .ticket-container { 
                display: grid !important; 
                grid-template-columns: 1fr 1fr !important; /* åˆ—å°æ™‚ä¸€æ’å°å…©å¼µï¼Œç¯€çœç´™å¼µ */
                gap: 20px; 
                max-width: 100% !important;
            }
            .lottery-ticket {
                border: 2px solid #000;
                box-shadow: none;
                margin-bottom: 0;
            }
            .bingo-grid {
                border-color: #000;
                background-color: #000;
            }
            .bingo-cell {
                border-color: #000;
                color: #000;
            }
        }
        
        .section-content { display: none; }
        .section-content.active { display: flex; }

    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <!-- å°è¦½åˆ— -->
    <nav class="w-full max-w-5xl mt-4 px-4 flex gap-2 no-print">
        <div onclick="switchTab('print')" id="tab-print" class="tab-btn active flex-1 text-center">
            ğŸ–¨ï¸ è£½ä½œ/åˆ—å°å½©åˆ¸
        </div>
        <div onclick="switchTab('game')" id="tab-game" class="tab-btn flex-1 text-center">
            ğŸ² é–‹å§‹é–‹çéŠæˆ²
        </div>
    </nav>

    <!-- é é¢å®¹å™¨ -->
    <div class="w-full max-w-5xl bg-white min-h-[80vh] shadow-xl p-4 md:p-8 relative">

        <!-- ======================= -->
        <!-- SECTION 1: è£½ä½œå½©åˆ¸æ¨¡å¼ -->
        <!-- ======================= -->
        <div id="section-print" class="section-content active flex-col w-full">
            
            <div id="setup-area" class="text-center mb-8 border-b pb-6">
                <h2 class="text-3xl font-black text-red-800 mb-4">ğŸ–¨ï¸ ç”¢ç”Ÿ 7x7 è³“æœç›¤</h2>
                <div class="flex flex-col md:flex-row items-center justify-center gap-4 bg-yellow-50 p-6 rounded-xl border-2 border-yellow-200">
                    <label class="text-xl font-bold text-gray-700">
                        è«‹å•æœ‰å¤šå°‘ä½é•·è¼©è¦ç©ï¼Ÿ
                    </label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="playerCount" value="6" min="1" max="100" 
                            class="text-3xl font-bold w-24 text-center p-2 border-2 border-gray-300 rounded-lg focus:border-red-500 outline-none">
                        <span class="text-xl font-bold text-gray-700">äºº</span>
                    </div>
                    <button onclick="generateTickets()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-3 px-8 rounded-xl shadow transition">
                        âš¡ é–‹å§‹ç”¢ç”Ÿè³“æœç›¤
                    </button>
                </div>
                
                <div id="print-actions" class="hidden mt-6 flex justify-center gap-4">
                    <button onclick="window.print()" class="bg-green-600 hover:bg-green-700 text-white text-xl font-bold py-3 px-10 rounded-xl shadow flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        åˆ—å°è³“æœç›¤
                    </button>
                    <button onclick="clearTickets()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl">
                        æ¸…é™¤é‡è¨­
                    </button>
                </div>
                <p class="mt-4 text-gray-500 text-sm">
                    ğŸ’¡ èªªæ˜ï¼šç”¢ç”Ÿ 7x7 æ ¼å­ï¼ŒåŒ…å« 1-49 æ‰€æœ‰è™Ÿç¢¼ï¼ˆéš¨æ©Ÿæ’åˆ—ï¼‰ã€‚é•·è¼©æ¯æŠ½ä¸€çƒéƒ½ä¸€å®šèƒ½åœ¨ç›¤é¢ä¸Šæ‰¾åˆ°æ•¸å­—ã€‚
                </p>
            </div>

            <div id="ticket-output" class="ticket-container">
                <div class="col-span-1 text-center text-gray-400 py-10 text-xl">
                    è«‹è¼¸å…¥äººæ•¸ä¸¦æŒ‰ä¸‹ã€Œç”¢ç”Ÿã€æŒ‰éˆ•
                </div>
            </div>
        </div>


        <!-- ======================= -->
        <!-- SECTION 2: é–‹çéŠæˆ²æ¨¡å¼ -->
        <!-- ======================= -->
        <div id="section-game" class="section-content flex-col md:flex-row gap-8 items-start justify-center">
            
            <!-- å·¦å´æ¸…å–® -->
            <div class="w-full md:w-1/2 flex flex-col order-2 md:order-1">
                <div class="bg-red-50 rounded-2xl p-4 border-4 border-red-200 shadow-xl min-h-[400px]">
                    <h2 class="text-2xl font-black text-red-800 text-center mb-4 border-b-2 border-red-200 pb-2">
                        ğŸ“¢ å·²é–‹å‡ºè™Ÿç¢¼
                    </h2>
                    <!-- ã€ä¿®æ”¹ã€‘å°‡ grid-cols-4 æ”¹ç‚º grid-cols-5ï¼Œgap æ”¹ç‚º gap-1 (æ›´ç·Šæ¹Š) -->
                    <div id="drawnList" class="grid grid-cols-5 gap-1 auto-rows-max p-2"></div>
                    <div id="emptyTip" class="text-center text-gray-400 py-20 text-xl font-bold">
                        å°šæœªé–‹ç<br><span class="text-base font-normal">è«‹æŒ‰å³é‚ŠæŒ‰éˆ•é–‹å§‹</span>
                    </div>
                </div>
            </div>

            <!-- å³å´æ»¾çƒæ©Ÿ -->
            <div class="w-full md:w-1/2 flex flex-col items-center gap-6 order-1 md:order-2">
                <div class="machine-container relative" id="machine">
                    <div class="machine-shine"></div>
                    <div id="resultBall" class="result-ball">?</div>
                    <div id="rollingText" class="rolling-text">88</div>
                    <div id="particlesArea" class="absolute inset-0 z-0"></div>
                </div>

                <div id="statusMessage" class="text-xl font-bold text-yellow-600 h-8 text-center">
                    æº–å‚™é–‹å§‹æŠ½ç...
                </div>

                <div class="w-full max-w-sm flex flex-col gap-3">
                    <button id="drawBtn" class="big-btn w-full py-5 rounded-2xl text-white text-3xl font-black shadow-lg flex items-center justify-center gap-2">
                        <span>ğŸ‘‡ æŒ‰æˆ‘æŠ½è™Ÿç¢¼</span>
                    </button>
                    
                    <div class="flex justify-between items-center px-2 mt-2">
                        <span class="text-gray-500 font-bold">å‰©é¤˜: <span id="remainingCount" class="text-red-600 text-2xl">49</span> å€‹</span>
                        <button onclick="resetGame()" class="reset-btn shadow hover:bg-red-700 transition">
                            ğŸ”„ å…¨éƒ¨é‡ä¾†
                        </button>
                    </div>
                </div>

                <div class="w-full max-w-sm bg-white p-4 rounded-xl shadow-lg border-2 border-orange-200">
                    <h3 class="text-center text-lg font-bold text-gray-700 mb-2 border-b pb-1">è™Ÿç¢¼æ ¸å°è¡¨</h3>
                    <div class="grid grid-cols-7 gap-2" id="historyGrid"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            document.querySelectorAll('.section-content').forEach(sec => sec.classList.remove('active'));
            document.getElementById(`section-${tab}`).classList.add('active');
            
            if (tab === 'game' && availableNumbers.length === 0) {
                initGame();
            }
        }

        /* === ç”¢ç”Ÿç¥¨åˆ¸é‚è¼¯ï¼š7x7 è³“æœç›¤ === */
        function generateTickets() {
            const count = parseInt(document.getElementById('playerCount').value);
            const output = document.getElementById('ticket-output');
            const actions = document.getElementById('print-actions');
            
            if (!count || count <= 0) {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„äººæ•¸ï¼");
                return;
            }

            output.innerHTML = ''; 
            actions.classList.remove('hidden');

            for (let i = 1; i <= count; i++) {
                // 1. ç”¢ç”Ÿ 1-49 çš„é™£åˆ—
                let nums = Array.from({length: 49}, (_, k) => k + 1);
                
                // 2. æ´—ç‰Œ
                for (let k = nums.length - 1; k > 0; k--) {
                    const j = Math.floor(Math.random() * (k + 1));
                    [nums[k], nums[j]] = [nums[j], nums[k]];
                }

                // 3. å»ºç«‹è³“æœç›¤ HTML
                const ticket = document.createElement('div');
                ticket.className = 'lottery-ticket';
                
                // ç”Ÿæˆ 49 å€‹æ ¼å­
                let gridHtml = '<div class="bingo-grid">';
                nums.forEach(n => {
                    gridHtml += `<div class="bingo-cell">${n}</div>`;
                });
                gridHtml += '</div>';

                ticket.innerHTML = `
                    <div class="ticket-header">
                        <h3 class="text-3xl font-black text-red-700 tracking-wider">ğŸ§§ å…¨ä½‘æ¨‚é€å½©è³“æœ ğŸ§§</h3>
                        <p class="text-sm text-gray-500">ç¬¬ ${i} å¼µ</p>
                    </div>
                    ${gridHtml}
                `;
                output.appendChild(ticket);
            }
        }

        function clearTickets() {
            document.getElementById('ticket-output').innerHTML = '<div class="col-span-1 text-center text-gray-400 py-10 text-xl">è«‹è¼¸å…¥äººæ•¸ä¸¦æŒ‰ä¸‹ã€Œç”¢ç”Ÿã€æŒ‰éˆ•</div>';
            document.getElementById('print-actions').classList.add('hidden');
        }

        /* ========================
           é–‹çéŠæˆ²é‚è¼¯
           ======================== */
        const TOTAL_NUMBERS = 49; 
        let availableNumbers = [];
        let drawnSequence = []; 
        let isRolling = false;

        const resultBall = document.getElementById('resultBall');
        const rollingText = document.getElementById('rollingText');
        const machine = document.getElementById('machine');
        const drawBtn = document.getElementById('drawBtn'); 
        const historyGrid = document.getElementById('historyGrid');
        const drawnList = document.getElementById('drawnList');
        const emptyTip = document.getElementById('emptyTip');
        const remainingCountSpan = document.getElementById('remainingCount');
        const statusMessage = document.getElementById('statusMessage');
        const particlesArea = document.getElementById('particlesArea');

        function initGame() {
            availableNumbers = Array.from({length: TOTAL_NUMBERS}, (_, i) => i + 1);
            drawnSequence = [];
            
            resultBall.classList.remove('show');
            resultBall.textContent = "?";
            updateRemainingCount();
            statusMessage.textContent = "æº–å‚™é–‹å§‹æŠ½ç...";
            statusMessage.className = "text-xl font-bold text-yellow-600 h-8 text-center";
            
            setButtonsState(false);
            
            historyGrid.innerHTML = '';
            for (let i = 1; i <= TOTAL_NUMBERS; i++) {
                const ball = document.createElement('div');
                ball.className = 'grid-ball';
                ball.id = `ball-${i}`;
                ball.textContent = i;
                historyGrid.appendChild(ball);
            }

            drawnList.innerHTML = '';
            emptyTip.style.display = 'block';
            particlesArea.innerHTML = '';
        }

        function updateRemainingCount() {
            if(remainingCountSpan) remainingCountSpan.textContent = availableNumbers.length;
        }

        function setButtonsState(disabled) {
            if (!drawBtn) return;
            if (disabled) {
                drawBtn.disabled = true;
                drawBtn.textContent = "ğŸ² æ»¾å‹•ä¸­...";
            } else {
                if (availableNumbers.length === 0) {
                    drawBtn.disabled = true;
                    drawBtn.textContent = "ğŸ‰ å…¨æŠ½å®Œäº†";
                    statusMessage.textContent = "éŠæˆ²çµæŸï¼Œè«‹æŒ‰é‡ç½®";
                } else {
                    drawBtn.disabled = false;
                    drawBtn.innerHTML = "<span>ğŸ‘‡ æŒ‰æˆ‘æŠ½è™Ÿç¢¼</span>";
                }
            }
        }

        function createParticles() {
            particlesArea.innerHTML = '';
            const colors = ['#f1c40f', '#e74c3c', '#3498db', '#9b59b6', '#2ecc71'];
            for(let i=0; i<10; i++) {
                const p = document.createElement('div');
                p.className = 'bg-particle';
                const size = Math.random() * 20 + 15;
                p.style.width = `${size}px`;
                p.style.height = `${size}px`;
                p.style.background = colors[Math.floor(Math.random() * colors.length)];
                p.style.left = `${Math.random() * 80 + 10}%`;
                p.style.top = `${Math.random() * 80 + 10}%`;
                p.style.transition = 'all 0.2s ease';
                particlesArea.appendChild(p);
            }
        }

        function animateParticles() {
            if(!isRolling) return;
            const particles = particlesArea.children;
            for(let p of particles) {
                p.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)`;
            }
            requestAnimationFrame(() => setTimeout(animateParticles, 100));
        }

        function performSingleDraw() {
            return new Promise((resolve) => {
                resultBall.classList.remove('show');
                machine.classList.add('rolling');
                
                createParticles();
                animateParticles(); 

                let rollInterval = setInterval(() => {
                    const randomShow = Math.floor(Math.random() * 49) + 1; 
                    rollingText.textContent = randomShow;
                }, 50);

                const waitTime = 1500; 

                setTimeout(() => {
                    clearInterval(rollInterval);
                    machine.classList.remove('rolling');
                    
                    const randomIndex = Math.floor(Math.random() * availableNumbers.length);
                    const drawnNumber = availableNumbers[randomIndex];
                    
                    availableNumbers.splice(randomIndex, 1);
                    drawnSequence.push(drawnNumber);

                    showResult(drawnNumber);
                    updateRemainingCount();
                    
                    resolve(drawnNumber);

                }, waitTime);
            });
        }

        if(drawBtn) {
            drawBtn.addEventListener('click', async () => {
                if (isRolling || availableNumbers.length === 0) return;
                isRolling = true;
                setButtonsState(true);
                statusMessage.textContent = "æ»¾å‹•ä¸­...";
                statusMessage.className = "text-xl font-bold text-blue-600 h-8 text-center";

                await performSingleDraw();

                isRolling = false;
                setButtonsState(false);
                particlesArea.innerHTML = '';
            });
        }

        function showResult(number) {
            resultBall.textContent = number;
            resultBall.classList.add('show');
            statusMessage.textContent = `æ­å–œï¼æŠ½åˆ°äº† ${number} è™Ÿ`;
            statusMessage.className = "text-xl font-bold text-red-600 h-8 text-center";
            
            const historyBall = document.getElementById(`ball-${number}`);
            if (historyBall) historyBall.classList.add('active');

            emptyTip.style.display = 'none';
            const listItem = document.createElement('div');
            listItem.className = 'list-ball-item'; 
            listItem.textContent = number; 
            drawnList.appendChild(listItem);
            
            const listContainer = drawnList.parentElement;
            setTimeout(() => { listContainer.scrollTop = listContainer.scrollHeight; }, 100);
        }

        function resetGame() {
            if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„é‡æ–°é–‹å§‹å—ï¼Ÿ")) initGame();
        }

        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html>